---

# üåê Angular Interceptor

## üîπ Definition

An **Interceptor** in Angular is like a **middleware** for HTTP requests and responses.
It sits **between your app and the server** and lets you **modify, monitor, or handle errors** before the request goes out or after the response comes back.

---

## üîπ Key Points

* Interceptors work with Angular‚Äôs **HttpClient**.
* Can **modify request** (e.g., add `Authorization` header).
* Can **modify response** (e.g., format data before passing to component).
* Can **handle errors globally** (e.g., expired session ‚Üí redirect).
* Can **log, retry, or show loading indicators**.
* Multiple interceptors can be chained ‚Üí executed in the order they are provided.

---

## üîπ Request & Response Flow

```
Component ‚Üí Http Request ‚Üí Interceptor(s) ‚Üí Server
Server ‚Üí Response ‚Üí Interceptor(s) ‚Üí Component
```

---

## üîπ Example: Simple Auth Interceptor

```ts
import { Injectable } from '@angular/core';
import {
  HttpInterceptor,
  HttpRequest,
  HttpHandler,
  HttpEvent
} from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // Example: add token
    const token = localStorage.getItem('authToken');

    let modifiedReq = req;
    if (token) {
      modifiedReq = req.clone({
        setHeaders: {
          Authorization: `Bearer ${token}`
        }
      });
    }

    console.log('Outgoing Request:', modifiedReq);

    return next.handle(modifiedReq);
  }
}
```

üìå **What happens here?**

1. Component sends request (e.g., `getUserProfile()`).
2. Interceptor catches it.
3. Adds `Authorization` header with token.
4. Sends modified request to server.
5. When response comes back ‚Üí Interceptor can log/modify it before component sees it.

---

## üîπ Example: Modify Response

```ts
import { Injectable } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpResponse } from '@angular/common/http';
import { Observable, map } from 'rxjs';

@Injectable()
export class ResponseInterceptor implements HttpInterceptor {
  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    return next.handle(req).pipe(
      map(event => {
        if (event instanceof HttpResponse) {
          console.log('Incoming Response:', event.body);
          // Example: unwrap API data { data: {...} } ‚Üí return only {...}
          if (event.body && event.body.data) {
            return event.clone({ body: event.body.data });
          }
        }
        return event;
      })
    );
  }
}
```

---

## üîπ Visual Diagram

```
                [ Angular Component ]
                         |
                         v
        -----------------------------------
        |          Request Phase          |
        -----------------------------------
            1. Component makes request
            2. Interceptor modifies request (e.g., add token)
            3. Modified request sent to server
                         |
                         v
                    [ Server API ]
                         |
                         v
        -----------------------------------
        |         Response Phase          |
        -----------------------------------
            4. Server sends response
            5. Interceptor can modify response (unwrap, log, handle error)
            6. Component receives final response
```

---

## ‚úÖ Quick Summary

* **Definition:** Middleware for HTTP in Angular.
* **Request:** Modify ‚Üí Add headers, tokens, log.
* **Response:** Modify ‚Üí Transform data, handle errors, retry.
* **Use cases:** Auth tokens (like Gmail), loading spinners, error handling, data formatting.

---
